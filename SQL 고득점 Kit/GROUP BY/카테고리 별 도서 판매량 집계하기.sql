USE programmers_groupBy;

CREATE TABLE BOOK (
    BOOK_ID INTEGER PRIMARY KEY NOT NULL,
    CATEGORY VARCHAR(50) NOT NULL,
    AUTHOR_ID INTEGER NOT NULL,
    PRICE INTEGER NOT NULL,
    PUBLISHED_DATE DATE NOT NULL
);

CREATE TABLE BOOK_SALES (
    BOOK_ID INTEGER,
    SALES_DATE DATE,
    SALES INTEGER,
    PRIMARY KEY (BOOK_ID, SALES_DATE),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID)
);

SHOW TABLES;

INSERT INTO BOOK (BOOK_ID, CATEGORY, AUTHOR_ID, PRICE, PUBLISHED_DATE)
VALUES
    (1, '인문', 1, 10000, '2020-01-01'),
    (2, '경제', 1, 9000, '2021-02-05'),
    (3, '경제', 2, 9000, '2021-03-11');

INSERT INTO BOOK_SALES (BOOK_ID, SALES_DATE, SALES)
VALUES
    (1, '2022-01-01', 2),
    (2, '2022-01-02', 3),
    (1, '2022-01-05', 1),
    (2, '2022-01-20', 5),
    (2, '2022-01-21', 6),
    (3, '2022-01-22', 2),
    (2, '2022-02-11', 3);

SELECT * FROM BOOK;

SELECT * FROM BOOK_SALES;

SELECT 
    CATEGORY, SUM(SALES) AS TOTAL_SALES
FROM
    BOOK AS B
        JOIN
    BOOK_SALES AS BS USING (BOOK_ID)
WHERE
    SALES_DATE LIKE '2022-01%'
GROUP BY 1
ORDER BY 1;